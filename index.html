<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist Safety Management System</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Section */
        .login-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-box h2 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }

        .role-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .role-btn.active {
            background: #667eea;
            color: white;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Dashboard Section */
        .dashboard-section {
            display: none;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 24px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            padding: 10px 20px;
            background: #ff5252;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .stat-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .stat-box .value {
            font-size: 32px;
            font-weight: bold;
        }

        #map {
            height: 400px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .alert-item {
            padding: 15px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .alert-item.high {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .alert-item.medium {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .alert-item.low {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }

        /* Tourist Section */
        .safety-score {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .safety-score .score {
            font-size: 64px;
            font-weight: bold;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 20px;
            background: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .action-btn:hover {
            transform: translateY(-3px);
        }

        .action-btn .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .sos-btn {
            background: #dc3545 !important;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        /* Forms */
        .form-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }

        .list-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.success {
            background: #d4edda;
            color: #155724;
        }

        .badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge.danger {
            background: #f8d7da;
            color: #721c24;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .danger-zone {
            fill: rgba(220, 53, 69, 0.3);
            stroke: #dc3545;
            stroke-width: 3;
        }

        .warning-zone {
            fill: rgba(255, 193, 7, 0.3);
            stroke: #ffc107;
            stroke-width: 3;
        }

        .risk-zone {
            fill: rgba(255, 152, 0, 0.3);
            stroke: #ff9800;
            stroke-width: 3;
        }

        .zone-popup {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .zone-popup h4 {
            margin: 0 0 8px 0;
            color: #333;
        }

        .zone-popup button {
            margin-top: 8px;
            padding: 5px 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .zone-popup button:hover {
            background: #c82333;
        }

        .zone-list-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .zone-list-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .zone-list-item.danger {
            border-left-color: #dc3545;
        }

        .zone-list-item.warning {
            border-left-color: #ffc107;
        }

        .zone-list-item.risk {
            border-left-color: #ff9800;
        }

        .weather-widget {
            padding: 15px;
        }

        .weather-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
            margin-bottom: 15px;
        }

        .weather-temp {
            font-size: 48px;
            font-weight: bold;
        }

        .weather-desc {
            font-size: 18px;
            margin-top: 5px;
        }

        .weather-icon {
            font-size: 64px;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .weather-detail-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .weather-detail-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .weather-detail-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .weather-alert {
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid;
        }

        .weather-alert.warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }

        .weather-alert.danger {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .weather-alert.info {
            background: #d1ecf1;
            border-left-color: #17a2b8;
            color: #0c5460;
        }

        .leaflet-tile-pane {
            filter: brightness(100%);
            transition: filter 0.3s ease;
        }

        .night-mode .leaflet-tile-pane {
            filter: brightness(60%) contrast(120%) saturate(70%);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div id="loginSection" class="login-section">
        <div class="login-box">
            <h2>üõ°Ô∏è Tourist Safety System</h2>
            
            <div class="role-selector">
                <button class="role-btn active" data-role="tourist">üë§ Tourist</button>
                <button class="role-btn" data-role="authority">üöî Authority</button>
            </div>

            <div class="input-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="Enter your email">
            </div>

            <div class="input-group">
                <label>Password</label>
                <input type="password" id="loginPassword" placeholder="Enter your password">
            </div>

            <button class="btn" id="loginBtn">Login</button>
            
            <div style="margin-top: 15px; text-align: center; color: #666; font-size: 14px;">
                <span>Don't have an account? <a href="#" id="showSignup" style="color: #667eea; text-decoration: none;">Sign up</a></span>
                <span style="margin: 0 10px;">|</span>
                <span><a href="#" id="showForgotPassword" style="color: #667eea; text-decoration: none;">Forgot Password?</a></span>
            </div>
        </div>
    </div>

    <!-- Signup Section -->
    <div id="signupSection" class="login-section" style="display: none;">
        <div class="login-box">
            <h2>üìù Create Account</h2>
            
            <div class="role-selector">
                <button class="role-btn active" data-role="tourist">üë§ Tourist</button>
                <button class="role-btn" data-role="authority">üöî Authority</button>
            </div>

            <div class="input-group">
                <label>Full Name</label>
                <input type="text" id="signupName" placeholder="Enter your full name">
            </div>

            <div class="input-group">
                <label>Email</label>
                <input type="email" id="signupEmail" placeholder="Enter your email">
            </div>

            <div class="input-group">
                <label>Password</label>
                <input type="password" id="signupPassword" placeholder="Enter password (min 6 characters)">
            </div>

            <div class="input-group">
                <label>Confirm Password</label>
                <input type="password" id="signupConfirmPassword" placeholder="Confirm your password">
            </div>

            <button class="btn" id="signupBtn">Create Account</button>
            
            <div style="margin-top: 15px; text-align: center; color: #666; font-size: 14px;">
                <span>Already have an account? <a href="#" id="showLogin" style="color: #667eea; text-decoration: none;">Login</a></span>
            </div>
        </div>
    </div>

    <!-- Forgot Password Section -->
    <div id="forgotPasswordSection" class="login-section" style="display: none;">
        <div class="login-box">
            <h2>üîë Reset Password</h2>
            
            <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 14px;">
                Enter your email and we'll send you a link to reset your password.
            </p>

            <div class="input-group">
                <label>Email</label>
                <input type="email" id="resetEmail" placeholder="Enter your email">
            </div>

            <button class="btn" id="resetBtn">Send Reset Link</button>
            
            <div style="margin-top: 15px; text-align: center; color: #666; font-size: 14px;">
                <span>Remember your password? <a href="#" id="backToLogin" style="color: #667eea; text-decoration: none;">Login</a></span>
            </div>
        </div>
    </div>

    <!-- Authority Dashboard -->
    <div id="authorityDashboard" class="dashboard-section">
        <div class="container">
            <div class="header">
                <h1>üöî Authority Dashboard</h1>
                <div class="user-info">
                    <span id="authorityUserName">Authority User</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <h3>üìä Statistics</h3>
                    <div class="stat-box">
                        <div>
                            <div style="font-size: 14px; opacity: 0.9;">Active Tourists</div>
                            <div class="value" id="activeTourists">0</div>
                        </div>
                        <div style="font-size: 48px;">üë•</div>
                    </div>
                    <div class="stat-box">
                        <div>
                            <div style="font-size: 14px; opacity: 0.9;">Active Alerts</div>
                            <div class="value" id="activeAlerts">0</div>
                        </div>
                        <div style="font-size: 48px;">‚ö†Ô∏è</div>
                    </div>
                    <div class="stat-box">
                        <div>
                            <div style="font-size: 14px; opacity: 0.9;">Incidents Today</div>
                            <div class="value" id="incidentsToday">0</div>
                        </div>
                        <div style="font-size: 48px;">üö®</div>
                    </div>
                </div>

                <div class="card" style="grid-column: span 2;">
                    <h3>üó∫Ô∏è Live Tourist Map</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                        <button class="btn" id="drawDangerZoneBtn" onclick="toggleDrawDangerZone('danger')" style="background: #dc3545;">
                            ‚ö†Ô∏è Draw Danger Zone
                        </button>
                        <button class="btn" id="drawWarningZoneBtn" onclick="toggleDrawDangerZone('warning')" style="background: #ffc107; color: #000;">
                            ‚ö° Draw Warning Zone
                        </button>
                        <button class="btn" id="drawRiskZoneBtn" onclick="toggleDrawDangerZone('risk')" style="background: #ff9800; color: #fff;">
                            üî∂ Draw Risk Zone
                        </button>
                        <button class="btn" onclick="cancelDrawing()" style="background: #6c757d;">
                            ‚ùå Cancel
                        </button>
                        <button class="btn" onclick="viewZonesList()" style="background: #17a2b8;">
                            üìã View Zones
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="toggleNightMode()" style="background: #495057;">
                            üåô Night Mode
                        </button>
                        <select id="mapStyleSelect" onchange="changeMapStyle(this.value)" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="default">üó∫Ô∏è Default Map</option>
                            <option value="satellite">üõ∞Ô∏è Satellite</option>
                            <option value="terrain">üèîÔ∏è Terrain</option>
                            <option value="dark">üåë Dark Mode</option>
                        </select>
                        <button class="btn" onclick="toggleMarkerClustering()" style="background: #6610f2;">
                            üìç Cluster Markers
                        </button>
                    </div>
                    <div id="drawingHint" style="display: none; padding: 10px; background: #fff3cd; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #ffc107;">
                        <strong>Drawing Mode Active:</strong> Click on the map to add points. Double-click or click the first point to complete the zone.
                    </div>
                    <div id="map"></div>
                </div>

                <div class="card">
                    <h3>üå§Ô∏è Weather & Safety Conditions</h3>
                    <div id="weatherWidget">
                        <div class="loading">Loading weather...</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card" style="grid-column: span 3;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3>üë• Tourist Management</h3>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="searchTourist" placeholder="Search tourists..." style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <select id="filterStatus" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="all">All Status</option>
                                <option value="active">Active</option>
                                <option value="sos">SOS Alert</option>
                            </select>
                            <button class="btn" onclick="exportTouristData()" style="padding: 8px 15px;">üì• Export</button>
                        </div>
                    </div>
                    <div id="touristsList">
                        <div class="loading">Loading tourists...</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card" style="grid-column: span 2;">
                    <h3>‚ö†Ô∏è Recent Alerts</h3>
                    <div id="alertsList">
                        <div class="loading">Loading alerts...</div>
                    </div>
                </div>

                <div class="card">
                    <h3>üì¢ Broadcast Alert</h3>
                    <div class="input-group">
                        <label>Alert Title</label>
                        <input type="text" id="alertTitle" placeholder="Enter alert title">
                    </div>
                    <div class="input-group">
                        <label>Message</label>
                        <textarea id="alertMessage" placeholder="Enter alert message"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Severity</label>
                        <select id="alertSeverity" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <button class="btn" onclick="broadcastAlert()">Broadcast Alert</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tourist Dashboard -->
    <div id="touristDashboard" class="dashboard-section">
        <div class="container">
            <div class="header">
                <h1>üõ°Ô∏è Tourist Safety</h1>
                <div class="user-info">
                    <span id="touristUserName">Tourist User</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="safety-score">
                <div style="font-size: 20px; margin-bottom: 10px;">Your Safety Score</div>
                <div class="score" id="safetyScore">85%</div>
                <div style="font-size: 16px; margin-top: 10px;">You're in a relatively safe area</div>
            </div>

            <div class="quick-actions">
                <button class="action-btn sos-btn" onclick="sendSOS()">
                    <div class="icon">üö®</div>
                    <div>SOS</div>
                </button>
                <button class="action-btn" onclick="showSection('safety')">
                    <div class="icon">üìä</div>
                    <div>Safety Info</div>
                </button>
                <button class="action-btn" onclick="showSection('emergency')">
                    <div class="icon">üìû</div>
                    <div>Emergency</div>
                </button>
                <button class="action-btn" onclick="showSafetyTips()">
                    <div class="icon">üìö</div>
                    <div>Safety Tips</div>
                </button>
                <button class="action-btn" onclick="showSection('itinerary')">
                    <div class="icon">üìÖ</div>
                    <div>My Plans</div>
                </button>
            </div>

            <div class="dashboard-grid">
                <div class="card" style="grid-column: span 2;">
                    <h3>üó∫Ô∏è My Location & Nearby Places</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="toggleTouristNightMode()" style="padding: 8px 15px; background: #495057;">
                            üåô Night Mode
                        </button>
                        <select id="touristMapStyleSelect" onchange="changeTouristMapStyle(this.value)" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="default">üó∫Ô∏è Default Map</option>
                            <option value="satellite">üõ∞Ô∏è Satellite</option>
                            <option value="terrain">üèîÔ∏è Terrain</option>
                        </select>
                    </div>
                    <div id="touristMap" style="height: 350px; border-radius: 10px; margin-top: 15px;"></div>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="findNearbyOnMap('hospital')" style="padding: 8px 15px; flex: 1; min-width: 120px;">üè• Hospitals</button>
                        <button class="btn" onclick="findNearbyOnMap('police')" style="padding: 8px 15px; flex: 1; min-width: 120px;">üöî Police</button>
                        <button class="btn" onclick="findNearbyOnMap('tourist_attraction')" style="padding: 8px 15px; flex: 1; min-width: 120px;">üèõÔ∏è Tourist Spots</button>
                        <button class="btn" onclick="findNearbyOnMap('restaurant')" style="padding: 8px 15px; flex: 1; min-width: 120px;">üçΩÔ∏è Restaurants</button>
                        <button class="btn" onclick="centerTouristMap()" style="padding: 8px 15px; flex: 1; min-width: 120px;">üìç My Location</button>
                    </div>
                </div>

                <div class="card">
                    <h3>üå§Ô∏è Weather Conditions</h3>
                    <div id="touristWeatherWidget">
                        <div class="loading">Loading weather...</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>‚ö†Ô∏è Active Alerts</h3>
                <div id="touristAlertsList">
                    <div class="loading">Loading alerts...</div>
                </div>
            </div>

            <div class="card" style="grid-column: span 2;">
                <h3>üìÖ My Itinerary</h3>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <input type="text" id="itineraryPlace" placeholder="Place name" style="flex: 2; min-width: 150px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="date" id="itineraryDate" style="flex: 1; min-width: 120px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="time" id="itineraryTime" style="flex: 1; min-width: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <button class="btn" onclick="addItineraryItem()" style="padding: 8px 15px;">‚ûï Add</button>
                    </div>
                </div>
                <div id="itineraryList">
                    <div class="loading">Loading itinerary...</div>
                </div>
            </div>

            <!-- Safety Info Section -->
            <div id="safetySection" class="form-section hidden">
                <h3>üìä Safety Information</h3>
                <div style="margin-top: 20px;">
                    <div class="list-item">
                        <span><strong>Location Safety:</strong> Good</span>
                        <span class="badge success">90%</span>
                    </div>
                    <div class="list-item">
                        <span><strong>Crime Rate:</strong> Low</span>
                        <span class="badge success">85%</span>
                    </div>
                    <div class="list-item">
                        <span><strong>Traffic Safety:</strong> Moderate</span>
                        <span class="badge warning">75%</span>
                    </div>
                    <div class="list-item">
                        <span><strong>Health Facilities:</strong> Excellent</span>
                        <span class="badge success">95%</span>
                    </div>
                </div>
            </div>

            <!-- Emergency Contacts Section -->
            <div id="emergencySection" class="form-section hidden">
                <h3>üìû Emergency Contacts</h3>
                <div style="margin-top: 20px;">
                    <div class="list-item">
                        <div>
                            <strong>üöî Police</strong><br>
                            <span style="color: #666;">Emergency Response</span>
                        </div>
                        <a href="tel:100" style="color: #667eea; font-weight: bold; text-decoration: none;">100</a>
                    </div>
                    <div class="list-item">
                        <div>
                            <strong>üöë Ambulance</strong><br>
                            <span style="color: #666;">Medical Emergency</span>
                        </div>
                        <a href="tel:102" style="color: #667eea; font-weight: bold; text-decoration: none;">102</a>
                    </div>
                    <div class="list-item">
                        <div>
                            <strong>üî• Fire Service</strong><br>
                            <span style="color: #666;">Fire Emergency</span>
                        </div>
                        <a href="tel:101" style="color: #667eea; font-weight: bold; text-decoration: none;">101</a>
                    </div>
                    <div class="list-item">
                        <div>
                            <strong>üè• Tourist Helpline</strong><br>
                            <span style="color: #666;">24/7 Support</span>
                        </div>
                        <a href="tel:1363" style="color: #667eea; font-weight: bold; text-decoration: none;">1363</a>
                    </div>
                </div>
            </div>

            <!-- Itinerary Section -->
            <div id="itinerarySection" class="form-section hidden">
                <h3>üìÖ My Itinerary</h3>
                <div class="input-group">
                    <label>Location</label>
                    <input type="text" id="itineraryLocation" placeholder="Enter location">
                </div>
                <div class="input-group">
                    <label>Date & Time</label>
                    <input type="datetime-local" id="itineraryDateTime">
                </div>
                <div class="input-group">
                    <label>Notes</label>
                    <textarea id="itineraryNotes" placeholder="Add notes about this plan"></textarea>
                </div>
                <button class="btn" onclick="addItinerary()">Add to Itinerary</button>
                
                <div style="margin-top: 30px;">
                    <h4 style="margin-bottom: 15px;">Your Plans</h4>
                    <div id="itineraryList">
                        <div class="loading">Loading itinerary...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAadPtOI76iD47aCy4fsvOl6K6APHrEvNg",
            authDomain: "tourist-safety-sih.firebaseapp.com",
            projectId: "tourist-safety-sih",
            storageBucket: "tourist-safety-sih.firebasestorage.app",
            messagingSenderId: "693726857825",
            appId: "1:693726857825:web:24b18bed7fd1d51dc6f820"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        let currentUser = null;
        let currentRole = 'tourist';
        let map = null;
        let markers = [];

        // Role Selection
        document.querySelectorAll('.role-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentRole = this.dataset.role;
            });
        });

        // Form Navigation
        document.getElementById('showSignup')?.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('signupSection').style.display = 'flex';
            document.getElementById('forgotPasswordSection').style.display = 'none';
        });

        document.getElementById('showLogin')?.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('loginSection').style.display = 'flex';
            document.getElementById('signupSection').style.display = 'none';
            document.getElementById('forgotPasswordSection').style.display = 'none';
        });

        document.getElementById('backToLogin')?.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('loginSection').style.display = 'flex';
            document.getElementById('signupSection').style.display = 'none';
            document.getElementById('forgotPasswordSection').style.display = 'none';
        });

        document.getElementById('showForgotPassword')?.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('signupSection').style.display = 'none';
            document.getElementById('forgotPasswordSection').style.display = 'flex';
        });

        // Role selector for signup
        document.querySelectorAll('#signupSection .role-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('#signupSection .role-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Signup
        document.getElementById('signupBtn')?.addEventListener('click', async () => {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const role = document.querySelector('#signupSection .role-btn.active').dataset.role;

            // Validation
            if (!name || !email || !password || !confirmPassword) {
                alert('Please fill all fields');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                alert('Please enter a valid email address');
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Save user data to Firestore
                await db.collection('users').doc(user.uid).set({
                    name,
                    email,
                    role,
                    createdAt: new Date(),
                    status: 'active'
                });

                // Update profile
                await user.updateProfile({ displayName: name });

                alert('Account created successfully! Please login.');
                
                // Switch to login
                document.getElementById('loginSection').style.display = 'flex';
                document.getElementById('signupSection').style.display = 'none';
                
                // Pre-fill login email
                document.getElementById('loginEmail').value = email;
            } catch (error) {
                alert('Signup failed: ' + error.message);
                console.error(error);
            }
        });

        // Forgot Password
        document.getElementById('resetBtn')?.addEventListener('click', async () => {
            const email = document.getElementById('resetEmail').value;

            if (!email) {
                alert('Please enter your email address');
                return;
            }

            if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                alert('Please enter a valid email address');
                return;
            }

            try {
                await auth.sendPasswordResetEmail(email);
                alert('Password reset email sent! Please check your inbox.');
                
                // Switch to login
                document.getElementById('loginSection').style.display = 'flex';
                document.getElementById('forgotPasswordSection').style.display = 'none';
            } catch (error) {
                alert('Failed to send reset email: ' + error.message);
                console.error(error);
            }
        });

        // Login
        document.getElementById('loginBtn').addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Get user role from Firestore
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                if (userData && userData.role === currentRole) {
                    showDashboard(currentRole);
                } else {
                    alert('Invalid credentials for selected role');
                    await auth.signOut();
                }
            } catch (error) {
                alert('Login failed: ' + error.message);
                console.error(error);
            }
        });

        // Auth State Observer
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
            }
        });

        // Show Dashboard
        function showDashboard(role) {
            document.getElementById('loginSection').classList.add('hidden');
            
            if (role === 'authority') {
                document.getElementById('authorityDashboard').style.display = 'block';
                document.getElementById('authorityUserName').textContent = currentUser.email;
                initAuthorityDashboard();
            } else {
                document.getElementById('touristDashboard').style.display = 'block';
                document.getElementById('touristUserName').textContent = currentUser.email;
                initTouristDashboard();
            }
        }

        // Logout
        function logout() {
            auth.signOut();
            location.reload();
        }

        // Initialize Authority Dashboard
        // Danger Zone Variables
        let drawingMode = false;
        let currentZoneType = null;
        let tempMarkers = [];
        let tempPolyline = null;
        let dangerZones = [];

        function initAuthorityDashboard() {
            // Initialize Map
            setTimeout(() => {
                map = L.map('map').setView([28.6139, 77.2090], 12);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);

                // Load tourists on map
                loadTouristsOnMap();
                
                // Load danger zones
                loadDangerZones();
                
                // Add click handler for drawing
                map.on('click', handleMapClick);

                // Load weather for map center
                const center = map.getCenter();
                loadWeather(center.lat, center.lng, 'weatherWidget');
            }, 500);

            // Load statistics
            loadStatistics();
            
            // Load tourist list
            loadTouristList();
            
            // Load alerts
            loadAlerts('alertsList');

            // Real-time updates for alerts
            db.collection('alerts').orderBy('timestamp', 'desc').limit(10)
                .onSnapshot(snapshot => {
                    loadAlerts('alertsList');
                });
            
            // Real-time updates for tourists
            db.collection('tourists').onSnapshot(snapshot => {
                loadTouristList();
                loadTouristsOnMap();
                loadStatistics();
            });
        }

        // Toggle Danger Zone Drawing
        function toggleDrawDangerZone(zoneType) {
            drawingMode = true;
            currentZoneType = zoneType;
            tempMarkers = [];
            if (tempPolyline) {
                map.removeLayer(tempPolyline);
                tempPolyline = null;
            }
            document.getElementById('drawingHint').style.display = 'block';
            
            // Highlight active button
            document.querySelectorAll('.btn').forEach(btn => btn.style.opacity = '0.6');
            if (zoneType === 'danger') {
                document.getElementById('drawDangerZoneBtn').style.opacity = '1';
            } else if (zoneType === 'warning') {
                document.getElementById('drawWarningZoneBtn').style.opacity = '1';
            } else if (zoneType === 'risk') {
                document.getElementById('drawRiskZoneBtn').style.opacity = '1';
            }
        }

        function cancelDrawing() {
            drawingMode = false;
            currentZoneType = null;
            tempMarkers.forEach(marker => map.removeLayer(marker));
            tempMarkers = [];
            if (tempPolyline) {
                map.removeLayer(tempPolyline);
                tempPolyline = null;
            }
            document.getElementById('drawingHint').style.display = 'none';
            document.querySelectorAll('.btn').forEach(btn => btn.style.opacity = '1');
        }

        function handleMapClick(e) {
            if (!drawingMode) return;
            
            const latlng = e.latlng;
            
            // Add marker
            const marker = L.circleMarker(latlng, {
                radius: 6,
                fillColor: currentZoneType === 'danger' ? '#dc3545' : currentZoneType === 'warning' ? '#ffc107' : '#ff9800',
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);
            
            tempMarkers.push(marker);
            
            // Draw polyline
            if (tempMarkers.length > 1) {
                if (tempPolyline) {
                    map.removeLayer(tempPolyline);
                }
                const latlngs = tempMarkers.map(m => m.getLatLng());
                tempPolyline = L.polyline(latlngs, {
                    color: currentZoneType === 'danger' ? '#dc3545' : currentZoneType === 'warning' ? '#ffc107' : '#ff9800',
                    weight: 3,
                    opacity: 0.7,
                    dashArray: '10, 5'
                }).addTo(map);
            }
            
            // Complete zone on 3+ points and close proximity to first point
            if (tempMarkers.length >= 3) {
                const firstPoint = tempMarkers[0].getLatLng();
                const distance = map.distance(latlng, firstPoint);
                
                if (distance < 100) { // 100 meters threshold
                    completeZone();
                }
            }
        }

        async function completeZone() {
            if (tempMarkers.length < 3) {
                showNotification('Draw at least 3 points to create a zone', 'error');
                return;
            }
            
            const latlngs = tempMarkers.map(m => {
                const ll = m.getLatLng();
                return [ll.lat, ll.lng];
            });
            
            const zoneName = prompt(`Enter name for this ${currentZoneType} zone:`, `${currentZoneType.charAt(0).toUpperCase() + currentZoneType.slice(1)} Zone ${dangerZones.length + 1}`);
            
            if (!zoneName) {
                cancelDrawing();
                return;
            }
            
            const zoneData = {
                name: zoneName,
                type: currentZoneType,
                coordinates: latlngs,
                createdBy: currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                description: prompt('Add description (optional):', '') || ''
            };
            
            try {
                const docRef = await db.collection('dangerZones').add(zoneData);
                showNotification(`${currentZoneType.charAt(0).toUpperCase() + currentZoneType.slice(1)} zone created successfully!`, 'success');
                cancelDrawing();
                loadDangerZones();
            } catch (error) {
                console.error('Error saving zone:', error);
                showNotification('Failed to save zone', 'error');
            }
        }

        async function loadDangerZones() {
            if (!map) return;
            
            // Clear existing zones
            dangerZones.forEach(zone => {
                if (zone.polygon) map.removeLayer(zone.polygon);
            });
            dangerZones = [];
            
            try {
                const snapshot = await db.collection('dangerZones').get();
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const polygon = L.polygon(data.coordinates, {
                        className: `${data.type}-zone`,
                        color: data.type === 'danger' ? '#dc3545' : data.type === 'warning' ? '#ffc107' : '#ff9800',
                        fillColor: data.type === 'danger' ? '#dc3545' : data.type === 'warning' ? '#ffc107' : '#ff9800',
                        fillOpacity: 0.3,
                        weight: 3
                    }).addTo(map);
                    
                    const typeEmoji = data.type === 'danger' ? '‚ö†Ô∏è' : data.type === 'warning' ? '‚ö°' : 'üî∂';
                    const popupContent = `
                        <div class="zone-popup">
                            <h4>${typeEmoji} ${data.name}</h4>
                            <p><strong>Type:</strong> ${data.type.charAt(0).toUpperCase() + data.type.slice(1)}</p>
                            ${data.description ? `<p><strong>Description:</strong> ${data.description}</p>` : ''}
                            <p><small>Created: ${data.createdAt ? new Date(data.createdAt.toDate()).toLocaleString() : 'Just now'}</small></p>
                            <button onclick="deleteZone('${doc.id}')">Delete Zone</button>
                        </div>
                    `;
                    
                    polygon.bindPopup(popupContent);
                    
                    dangerZones.push({
                        id: doc.id,
                        polygon: polygon,
                        data: data
                    });
                });
                
                console.log(`Loaded ${dangerZones.length} danger zones`);
            } catch (error) {
                console.error('Error loading danger zones:', error);
            }
        }

        async function deleteZone(zoneId) {
            if (!confirm('Are you sure you want to delete this zone?')) return;
            
            try {
                await db.collection('dangerZones').doc(zoneId).delete();
                showNotification('Zone deleted successfully', 'success');
                loadDangerZones();
            } catch (error) {
                console.error('Error deleting zone:', error);
                showNotification('Failed to delete zone', 'error');
            }
        }

        function viewZonesList() {
            if (dangerZones.length === 0) {
                showNotification('No zones created yet', 'info');
                return;
            }
            
            let listHTML = '<h3 style="margin-top: 0;">üìã Danger Zones</h3>';
            dangerZones.forEach(zone => {
                const typeEmoji = zone.data.type === 'danger' ? '‚ö†Ô∏è' : zone.data.type === 'warning' ? '‚ö°' : 'üî∂';
                listHTML += `
                    <div class="zone-list-item ${zone.data.type}" onclick="focusZone('${zone.id}')">
                        <strong>${typeEmoji} ${zone.data.name}</strong><br>
                        <small>${zone.data.type.charAt(0).toUpperCase() + zone.data.type.slice(1)} Zone</small>
                        ${zone.data.description ? `<br><small>${zone.data.description}</small>` : ''}
                    </div>
                `;
            });
            
            document.getElementById('alertsList').innerHTML = listHTML;
        }

        function focusZone(zoneId) {
            const zone = dangerZones.find(z => z.id === zoneId);
            if (zone && zone.polygon) {
                map.fitBounds(zone.polygon.getBounds());
                zone.polygon.openPopup();
            }
        }

        // Check if tourist is in danger zone
        function checkTouristInDangerZone(lat, lng) {
            for (const zone of dangerZones) {
                const point = L.latLng(lat, lng);
                const polygon = zone.polygon;
                
                // Check if point is inside polygon
                const bounds = polygon.getBounds();
                if (bounds.contains(point)) {
                    // More precise check using ray casting
                    if (isPointInPolygon(point, polygon.getLatLngs()[0])) {
                        return {
                            inDanger: true,
                            zone: zone.data
                        };
                    }
                }
            }
            return { inDanger: false };
        }

        // Ray casting algorithm for point in polygon
        function isPointInPolygon(point, polygon) {
            let inside = false;
            const x = point.lat, y = point.lng;
            
            for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
                const xi = polygon[i].lat, yi = polygon[i].lng;
                const xj = polygon[j].lat, yj = polygon[j].lng;
                
                const intersect = ((yi > y) !== (yj > y))
                    && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
                if (intersect) inside = !inside;
            }
            
            return inside;
        }

        // Initialize Tourist Dashboard
        let touristMap = null;
        let touristMarker = null;
        let nearbyMarkers = [];
        let currentTouristLocation = null;

        function initTouristDashboard() {
            loadAlerts('touristAlertsList');
            loadItinerary();
            calculateSafetyScore();

            // Initialize tourist map
            setTimeout(() => {
                initTouristMap();
            }, 500);

            // Load weather for tourist location
            setTimeout(() => {
                if (currentTouristLocation) {
                    loadWeather(currentTouristLocation[0], currentTouristLocation[1], 'touristWeatherWidget');
                } else {
                    // Default to Delhi if location not available
                    loadWeather(28.6139, 77.2090, 'touristWeatherWidget');
                }
            }, 1000);

            // Real-time alerts
            db.collection('alerts').orderBy('timestamp', 'desc').limit(5)
                .onSnapshot(snapshot => {
                    loadAlerts('touristAlertsList');
                });

            // Real-time itinerary
            db.collection('itinerary')
                .where('touristId', '==', currentUser.uid)
                .onSnapshot(snapshot => {
                    loadItinerary();
                });
        }

        // Initialize Tourist Map
        function initTouristMap() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        currentTouristLocation = [lat, lng];

                        // Create map centered on user's location
                        touristMap = L.map('touristMap').setView([lat, lng], 14);
                        
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '¬© OpenStreetMap contributors'
                        }).addTo(touristMap);

                        // Add marker for user's location
                        const userIcon = L.divIcon({
                            className: 'custom-div-icon',
                            html: "<div style='background-color:#4285f4; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);'></div>",
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        });

                        touristMarker = L.marker([lat, lng], { icon: userIcon })
                            .addTo(touristMap)
                            .bindPopup('<strong>üìç Your Location</strong>')
                            .openPopup();

                        // Update location in Firestore
                        updateTouristLocation(lat, lng);
                    },
                    (error) => {
                        console.error('Error getting location:', error);
                        // Default to Delhi if location access denied
                        touristMap = L.map('touristMap').setView([28.6139, 77.2090], 12);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '¬© OpenStreetMap contributors'
                        }).addTo(touristMap);
                        alert('Please enable location access to see your position on the map');
                    }
                );
            } else {
                alert('Geolocation is not supported by your browser');
            }
        }

        // Update Tourist Location in Firestore
        async function updateTouristLocation(lat, lng) {
            try {
                await db.collection('tourists').doc(currentUser.uid).set({
                    userId: currentUser.uid,
                    email: currentUser.email,
                    location: new firebase.firestore.GeoPoint(lat, lng),
                    lastUpdate: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'active'
                }, { merge: true });
            } catch (error) {
                console.error('Error updating location:', error);
            }
        }

        // Center Map on Tourist Location
        function centerTouristMap() {
            if (touristMap && currentTouristLocation) {
                touristMap.setView(currentTouristLocation, 14);
                if (touristMarker) {
                    touristMarker.openPopup();
                }
            } else {
                alert('Getting your current location...');
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        currentTouristLocation = [lat, lng];
                        touristMap.setView([lat, lng], 14);
                        
                        if (touristMarker) {
                            touristMarker.setLatLng([lat, lng]);
                        }
                        
                        updateTouristLocation(lat, lng);
                    });
                }
            }
        }

        // Find Nearby Places on Map
        function findNearbyOnMap(category) {
            if (!currentTouristLocation) {
                alert('Please enable location access first');
                return;
            }

            // Clear existing nearby markers
            nearbyMarkers.forEach(marker => touristMap.removeLayer(marker));
            nearbyMarkers = [];

            // Mock nearby places data (in production, use Google Places API or Overpass API)
            const mockPlaces = {
                hospital: [
                    { name: 'City Hospital', lat: currentTouristLocation[0] + 0.01, lng: currentTouristLocation[1] + 0.01, phone: 'üìû +91-123-456-7890' },
                    { name: 'Medical Center', lat: currentTouristLocation[0] - 0.015, lng: currentTouristLocation[1] + 0.02, phone: 'üìû +91-123-456-7891' },
                    { name: 'Emergency Clinic', lat: currentTouristLocation[0] + 0.02, lng: currentTouristLocation[1] - 0.01, phone: 'üìû +91-123-456-7892' }
                ],
                police: [
                    { name: 'Central Police Station', lat: currentTouristLocation[0] + 0.008, lng: currentTouristLocation[1] - 0.012, phone: 'üìû 100' },
                    { name: 'Tourist Police', lat: currentTouristLocation[0] - 0.01, lng: currentTouristLocation[1] - 0.015, phone: 'üìû 1363' },
                    { name: 'Police Outpost', lat: currentTouristLocation[0] + 0.018, lng: currentTouristLocation[1] + 0.008, phone: 'üìû 100' }
                ],
                tourist_attraction: [
                    { name: 'Historical Monument', lat: currentTouristLocation[0] + 0.025, lng: currentTouristLocation[1] + 0.015, phone: '‚≠ê 4.5/5' },
                    { name: 'Museum', lat: currentTouristLocation[0] - 0.02, lng: currentTouristLocation[1] + 0.025, phone: '‚≠ê 4.7/5' },
                    { name: 'Garden Park', lat: currentTouristLocation[0] + 0.015, lng: currentTouristLocation[1] - 0.02, phone: '‚≠ê 4.3/5' }
                ],
                restaurant: [
                    { name: 'Local Cuisine Restaurant', lat: currentTouristLocation[0] + 0.005, lng: currentTouristLocation[1] + 0.008, phone: '‚≠ê 4.2/5' },
                    { name: 'Fine Dining', lat: currentTouristLocation[0] - 0.012, lng: currentTouristLocation[1] + 0.01, phone: '‚≠ê 4.8/5' },
                    { name: 'Street Food Corner', lat: currentTouristLocation[0] + 0.008, lng: currentTouristLocation[1] - 0.015, phone: '‚≠ê 4.0/5' }
                ]
            };

            const places = mockPlaces[category] || [];
            const icons = {
                hospital: 'üè•',
                police: 'üöî',
                tourist_attraction: 'üèõÔ∏è',
                restaurant: 'üçΩÔ∏è'
            };

            places.forEach(place => {
                const marker = L.marker([place.lat, place.lng])
                    .addTo(touristMap)
                    .bindPopup(`<strong>${icons[category]} ${place.name}</strong><br>${place.phone}<br><small>~${(Math.random() * 2 + 0.5).toFixed(1)} km away</small>`);
                
                nearbyMarkers.push(marker);
            });

            // Fit map to show all markers
            const group = L.featureGroup([touristMarker, ...nearbyMarkers]);
            touristMap.fitBounds(group.getBounds().pad(0.1));

            alert(`Found ${places.length} ${category.replace('_', ' ')}(s) nearby!`);
        }

        // Advanced Map Features
        let nightModeEnabled = false;
        let currentMapStyle = 'default';
        let markerClusteringEnabled = false;
        let currentTileLayer = null;

        function toggleNightMode() {
            nightModeEnabled = !nightModeEnabled;
            const mapContainer = document.getElementById('map');
            if (nightModeEnabled) {
                mapContainer.classList.add('night-mode');
                showNotification('Night mode enabled - Better visibility in dark', 'info');
            } else {
                mapContainer.classList.remove('night-mode');
                showNotification('Night mode disabled', 'info');
            }
        }

        function toggleTouristNightMode() {
            nightModeEnabled = !nightModeEnabled;
            const mapContainer = document.getElementById('touristMap');
            if (nightModeEnabled) {
                mapContainer.classList.add('night-mode');
                showNotification('Night mode enabled', 'info');
            } else {
                mapContainer.classList.remove('night-mode');
                showNotification('Night mode disabled', 'info');
            }
        }

        function changeMapStyle(style) {
            if (!map) return;
            
            // Remove current tile layer
            if (currentTileLayer) {
                map.removeLayer(currentTileLayer);
            }

            let tileUrl = '';
            let attribution = '¬© OpenStreetMap contributors';

            switch(style) {
                case 'satellite':
                    tileUrl = 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}';
                    attribution = '¬© Esri';
                    break;
                case 'terrain':
                    tileUrl = 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png';
                    attribution = '¬© OpenTopoMap contributors';
                    break;
                case 'dark':
                    tileUrl = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';
                    attribution = '¬© CartoDB';
                    break;
                default:
                    tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
            }

            currentTileLayer = L.tileLayer(tileUrl, { attribution }).addTo(map);
            currentMapStyle = style;
            showNotification(`Map style changed to ${style}`, 'success');
        }

        function changeTouristMapStyle(style) {
            if (!touristMap) return;
            
            // Remove all tile layers
            touristMap.eachLayer(layer => {
                if (layer instanceof L.TileLayer) {
                    touristMap.removeLayer(layer);
                }
            });

            let tileUrl = '';
            let attribution = '¬© OpenStreetMap contributors';

            switch(style) {
                case 'satellite':
                    tileUrl = 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}';
                    attribution = '¬© Esri';
                    break;
                case 'terrain':
                    tileUrl = 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png';
                    attribution = '¬© OpenTopoMap contributors';
                    break;
                default:
                    tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
            }

            L.tileLayer(tileUrl, { attribution }).addTo(touristMap);
            showNotification(`Map style changed to ${style}`, 'success');
        }

        function toggleMarkerClustering() {
            markerClusteringEnabled = !markerClusteringEnabled;
            if (markerClusteringEnabled) {
                showNotification('Marker clustering enabled - Markers will group when zoomed out', 'success');
                loadTouristsOnMap(); // Reload with clustering
            } else {
                showNotification('Marker clustering disabled', 'info');
                loadTouristsOnMap(); // Reload without clustering
            }
        }

        // Weather Integration
        const WEATHER_API_KEY = '8f8a5d1e5c3e4d7b9c6a2f1e8d3b5c7a'; // Free OpenWeatherMap key (demo)

        async function loadWeather(lat, lng, widgetId) {
            try {
                // Using OpenWeatherMap API (you'll need to get your own API key)
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&units=metric&appid=${WEATHER_API_KEY}`);
                
                if (!response.ok) {
                    throw new Error('Weather data unavailable');
                }

                const data = await response.json();
                
                // Get air quality
                const aqiResponse = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lng}&appid=${WEATHER_API_KEY}`);
                const aqiData = await aqiResponse.json();

                displayWeather(data, aqiData, widgetId);
            } catch (error) {
                console.error('Error loading weather:', error);
                displayMockWeather(widgetId);
            }
        }

        function displayWeather(data, aqiData, widgetId) {
            const temp = Math.round(data.main.temp);
            const feelsLike = Math.round(data.main.feels_like);
            const humidity = data.main.humidity;
            const windSpeed = Math.round(data.wind.speed * 3.6); // Convert m/s to km/h
            const description = data.weather[0].description;
            const icon = getWeatherIcon(data.weather[0].main);
            const aqi = aqiData?.list?.[0]?.main?.aqi || 3;
            const aqiLabel = ['Good', 'Fair', 'Moderate', 'Poor', 'Very Poor'][aqi - 1];

            const weatherHTML = `
                <div class="weather-widget">
                    <div class="weather-main">
                        <div>
                            <div class="weather-temp">${temp}¬∞C</div>
                            <div class="weather-desc">${description}</div>
                        </div>
                        <div class="weather-icon">${icon}</div>
                    </div>
                    
                    <div class="weather-details">
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Feels Like</div>
                            <div class="weather-detail-value">${feelsLike}¬∞C</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Humidity</div>
                            <div class="weather-detail-value">${humidity}%</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Wind Speed</div>
                            <div class="weather-detail-value">${windSpeed} km/h</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Air Quality</div>
                            <div class="weather-detail-value" style="color: ${getAQIColor(aqi)}">${aqiLabel}</div>
                        </div>
                    </div>

                    ${getWeatherAlerts(data, aqi)}
                </div>
            `;

            document.getElementById(widgetId).innerHTML = weatherHTML;
        }

        function displayMockWeather(widgetId) {
            const weatherHTML = `
                <div class="weather-widget">
                    <div class="weather-main">
                        <div>
                            <div class="weather-temp">28¬∞C</div>
                            <div class="weather-desc">Partly Cloudy</div>
                        </div>
                        <div class="weather-icon">‚õÖ</div>
                    </div>
                    
                    <div class="weather-details">
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Feels Like</div>
                            <div class="weather-detail-value">30¬∞C</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Humidity</div>
                            <div class="weather-detail-value">65%</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Wind Speed</div>
                            <div class="weather-detail-value">12 km/h</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Air Quality</div>
                            <div class="weather-detail-value" style="color: #28a745">Good</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">UV Index</div>
                            <div class="weather-detail-value" style="color: #ffc107">Moderate</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-label">Visibility</div>
                            <div class="weather-detail-value">10 km</div>
                        </div>
                    </div>

                    <div class="weather-alert info">
                        <strong>‚ÑπÔ∏è Weather Info:</strong> Conditions are favorable for outdoor activities. Stay hydrated!
                    </div>
                </div>
            `;

            document.getElementById(widgetId).innerHTML = weatherHTML;
        }

        function getWeatherIcon(condition) {
            const icons = {
                'Clear': '‚òÄÔ∏è',
                'Clouds': '‚òÅÔ∏è',
                'Rain': 'üåßÔ∏è',
                'Drizzle': 'üå¶Ô∏è',
                'Thunderstorm': '‚õàÔ∏è',
                'Snow': 'üå®Ô∏è',
                'Mist': 'üå´Ô∏è',
                'Fog': 'üå´Ô∏è',
                'Haze': 'üå´Ô∏è'
            };
            return icons[condition] || 'üå§Ô∏è';
        }

        function getAQIColor(aqi) {
            const colors = ['#28a745', '#85c926', '#ffc107', '#ff9800', '#dc3545'];
            return colors[aqi - 1] || '#6c757d';
        }

        function getWeatherAlerts(data, aqi) {
            let alerts = '';
            
            // Temperature alerts
            if (data.main.temp > 35) {
                alerts += `<div class="weather-alert danger"><strong>üå°Ô∏è Extreme Heat:</strong> Temperature is very high. Avoid direct sun exposure. Drink plenty of water.</div>`;
            } else if (data.main.temp < 10) {
                alerts += `<div class="weather-alert warning"><strong>‚ùÑÔ∏è Cold Weather:</strong> Temperature is low. Dress warmly.</div>`;
            }

            // Wind alerts
            if (data.wind.speed > 15) {
                alerts += `<div class="weather-alert warning"><strong>üí® Strong Winds:</strong> Wind speed is high. Be cautious outdoors.</div>`;
            }

            // Air quality alerts
            if (aqi >= 4) {
                alerts += `<div class="weather-alert danger"><strong>üò∑ Poor Air Quality:</strong> Air pollution is high. Avoid outdoor activities. Wear a mask if going out.</div>`;
            }

            // Rain alerts
            if (data.weather[0].main === 'Rain' || data.weather[0].main === 'Thunderstorm') {
                alerts += `<div class="weather-alert warning"><strong>üåßÔ∏è Rain Alert:</strong> ${data.weather[0].description}. Carry an umbrella. Roads may be slippery.</div>`;
            }

            // Humidity alerts
            if (data.main.humidity > 80) {
                alerts += `<div class="weather-alert info"><strong>üíß High Humidity:</strong> Humidity is ${data.main.humidity}%. You may feel uncomfortable.</div>`;
            }

            if (!alerts) {
                alerts = `<div class="weather-alert info"><strong>‚úÖ Good Conditions:</strong> Weather is favorable for outdoor activities!</div>`;
            }

            return alerts;
        }

        // Load Statistics
        async function loadStatistics() {
            try {
                const touristsSnap = await db.collection('tourists').get();
                document.getElementById('activeTourists').textContent = touristsSnap.size;

                const alertsSnap = await db.collection('alerts')
                    .where('status', '==', 'active').get();
                document.getElementById('activeAlerts').textContent = alertsSnap.size;

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const incidentsSnap = await db.collection('incidents')
                    .where('timestamp', '>=', today).get();
                document.getElementById('incidentsToday').textContent = incidentsSnap.size;
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Load Tourists on Map
        async function loadTouristsOnMap() {
            if (!map) return;

            markers.forEach(marker => map.removeLayer(marker));
            markers = [];

            try {
                const snapshot = await db.collection('tourists').get();
                
                if (snapshot.empty) {
                    console.log('No tourists found in database');
                    return;
                }
                
                snapshot.forEach(doc => {
                    const tourist = doc.data();
                    if (tourist.location) {
                        const lat = tourist.location.latitude || tourist.location._lat;
                        const lng = tourist.location.longitude || tourist.location._long;
                        
                        const marker = L.marker([lat, lng]).addTo(map);
                        
                        const lastUpdate = tourist.lastUpdate ? 
                            new Date(tourist.lastUpdate.toDate ? tourist.lastUpdate.toDate() : tourist.lastUpdate).toLocaleString() : 
                            'Unknown';
                        
                        marker.bindPopup(`
                            <strong>üìç Tourist</strong><br>
                            Email: ${tourist.email || 'N/A'}<br>
                            Status: ${tourist.status || 'Active'}<br>
                            <small>Last updated: ${lastUpdate}</small>
                        `);
                        
                        markers.push(marker);
                    }
                });
                
                console.log(`Loaded ${markers.length} tourists on map`);
            } catch (error) {
                console.error('Error loading tourists on map:', error);
            }
        }
        
        // Load Tourist List
        async function loadTouristList() {
            const container = document.getElementById('touristsList');
            if (!container) return;
            
            try {
                const snapshot = await db.collection('tourists').get();
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No tourists found. Tourists will appear here when they login and enable location tracking.</p>';
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const tourist = doc.data();
                    const lastUpdate = tourist.lastUpdate ? 
                        new Date(tourist.lastUpdate.toDate ? tourist.lastUpdate.toDate() : tourist.lastUpdate).toLocaleString() : 
                        'Never';
                    
                    let locationText = 'Location not available';
                    if (tourist.location) {
                        const lat = (tourist.location.latitude || tourist.location._lat || 0).toFixed(4);
                        const lng = (tourist.location.longitude || tourist.location._long || 0).toFixed(4);
                        locationText = `${lat}, ${lng}`;
                    }
                    
                    const statusBadge = tourist.status === 'sos' ? 
                        '<span class="badge danger">SOS</span>' : 
                        '<span class="badge success">Active</span>';
                    
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>üë§ ${tourist.email || 'Unknown Tourist'}</strong><br>
                                <span style="color: #666; font-size: 14px;">
                                    üìç ${locationText}<br>
                                    üïê ${lastUpdate}
                                </span>
                            </div>
                            ${statusBadge}
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                console.log(`Loaded ${snapshot.size} tourists in list`);
            } catch (error) {
                console.error('Error loading tourist list:', error);
                container.innerHTML = '<p style="color: #dc3545;">Error loading tourists. Check console for details.</p>';
            }
        }

        // Load Alerts
        async function loadAlerts(elementId) {
            const container = document.getElementById(elementId);
            
            try {
                const snapshot = await db.collection('alerts')
                    .orderBy('timestamp', 'desc')
                    .limit(elementId === 'touristAlertsList' ? 5 : 10)
                    .get();

                if (snapshot.empty) {
                    container.innerHTML = '<p style="color: #666; text-align: center;">No alerts</p>';
                    return;
                }

                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const alert = doc.data();
                    const div = document.createElement('div');
                    div.className = `alert-item ${alert.severity}`;
                    div.innerHTML = `
                        <strong>${alert.title}</strong>
                        <p style="margin: 8px 0; color: #666;">${alert.message}</p>
                        <small style="color: #999;">${new Date(alert.timestamp?.toDate()).toLocaleString()}</small>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading alerts:', error);
                container.innerHTML = '<p style="color: #dc3545;">Error loading alerts</p>';
            }
        }

        // Broadcast Alert
        async function broadcastAlert() {
            const title = document.getElementById('alertTitle').value;
            const message = document.getElementById('alertMessage').value;
            const severity = document.getElementById('alertSeverity').value;

            if (!title || !message) {
                alert('Please fill in all fields');
                return;
            }

            try {
                await db.collection('alerts').add({
                    title,
                    message,
                    severity,
                    status: 'active',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    authorityId: currentUser.uid
                });

                alert('Alert broadcasted successfully!');
                document.getElementById('alertTitle').value = '';
                document.getElementById('alertMessage').value = '';
            } catch (error) {
                alert('Error broadcasting alert: ' + error.message);
            }
        }

        // Send SOS
        async function sendSOS() {
            if (!confirm('Send SOS Alert? This will notify authorities immediately.')) {
                return;
            }

            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                });

                await db.collection('alerts').add({
                    title: 'SOS ALERT',
                    message: `Emergency SOS from ${currentUser.email}`,
                    severity: 'high',
                    status: 'active',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    touristId: currentUser.uid,
                    location: {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    }
                });

                alert('SOS sent! Authorities have been notified.');
            } catch (error) {
                alert('Error sending SOS: ' + error.message);
            }
        }

        // Calculate Safety Score
        async function calculateSafetyScore() {
            // Mock calculation - in real app, this would use location data
            const score = 85;
            document.getElementById('safetyScore').textContent = score + '%';
        }

        // Show Section
        function showSection(section) {
            document.querySelectorAll('.form-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
        }

        // Add Itinerary
        async function addItinerary() {
            const location = document.getElementById('itineraryLocation').value;
            const dateTime = document.getElementById('itineraryDateTime').value;
            const notes = document.getElementById('itineraryNotes').value;

            if (!location || !dateTime) {
                alert('Please fill in location and date/time');
                return;
            }

            try {
                await db.collection('itinerary').add({
                    touristId: currentUser.uid,
                    location,
                    dateTime: new Date(dateTime),
                    notes,
                    status: 'planned',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert('Added to itinerary!');
                document.getElementById('itineraryLocation').value = '';
                document.getElementById('itineraryDateTime').value = '';
                document.getElementById('itineraryNotes').value = '';
                loadItinerary();
            } catch (error) {
                alert('Error adding itinerary: ' + error.message);
            }
        }

        // Load Itinerary
        async function loadItinerary() {
            const container = document.getElementById('itineraryList');
            
            try {
                const snapshot = await db.collection('itinerary')
                    .where('touristId', '==', currentUser.uid)
                    .orderBy('dateTime', 'asc')
                    .get();

                if (snapshot.empty) {
                    container.innerHTML = '<p style="color: #666; text-align: center;">No plans yet</p>';
                    return;
                }

                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const item = doc.data();
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div>
                            <strong>${item.location}</strong><br>
                            <small style="color: #666;">${new Date(item.dateTime.toDate()).toLocaleString()}</small>
                            ${item.notes ? '<br><small>' + item.notes + '</small>' : ''}
                        </div>
                        <span class="badge ${item.status === 'completed' ? 'success' : 'warning'}">${item.status}</span>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading itinerary:', error);
                container.innerHTML = '<p style="color: #dc3545;">Error loading itinerary</p>';
            }
        }

        // Safety Tips Modal Functions
        function showSafetyTips() {
            document.getElementById('safetyTipsModal').style.display = 'flex';
        }

        function closeSafetyTips() {
            document.getElementById('safetyTipsModal').style.display = 'none';
        }

        // Export Tourist Data
        function exportTouristData() {
            const tourists = document.querySelectorAll('#touristsList .list-item');
            let csvContent = "Name,Email,Location,Status,Last Updated\n";
            
            tourists.forEach(tourist => {
                const name = tourist.querySelector('strong').textContent;
                const details = tourist.textContent.split('\n').filter(t => t.trim());
                csvContent += `${details.join(',')}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tourists_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Add Itinerary Item
        async function addItineraryItem() {
            const place = document.getElementById('itineraryPlace').value;
            const date = document.getElementById('itineraryDate').value;
            const time = document.getElementById('itineraryTime').value;

            if (!place || !date || !time) {
                alert('Please fill all fields');
                return;
            }

            try {
                await addDoc(collection(db, 'itineraries'), {
                    userId: auth.currentUser.uid,
                    place,
                    date,
                    time,
                    createdAt: new Date(),
                    completed: false
                });

                document.getElementById('itineraryPlace').value = '';
                document.getElementById('itineraryDate').value = '';
                document.getElementById('itineraryTime').value = '';
                
                loadItinerary();
                alert('Itinerary item added successfully!');
            } catch (error) {
                console.error('Error adding itinerary:', error);
                alert('Failed to add itinerary item');
            }
        }

        // Find Nearby Places (Mock implementation - integrate with real API)
        function findNearbyPlaces() {
            const category = document.getElementById('placeCategory').value;
            const container = document.getElementById('nearbyPlaces');
            
            const mockPlaces = {
                hospital: [
                    { name: 'City Hospital', distance: '1.2 km', phone: '+91-123-456-7890' },
                    { name: 'Medical Center', distance: '2.5 km', phone: '+91-123-456-7891' }
                ],
                police: [
                    { name: 'Central Police Station', distance: '0.8 km', phone: '100' },
                    { name: 'Tourist Police', distance: '1.5 km', phone: '1363' }
                ],
                tourist: [
                    { name: 'Historical Monument', distance: '3.2 km', rating: '4.5‚òÖ' },
                    { name: 'Museum', distance: '4.0 km', rating: '4.7‚òÖ' }
                ],
                restaurant: [
                    { name: 'Local Cuisine Restaurant', distance: '0.5 km', rating: '4.2‚òÖ' },
                    { name: 'Fine Dining', distance: '1.8 km', rating: '4.8‚òÖ' }
                ]
            };

            const places = mockPlaces[category] || [];
            container.innerHTML = places.map(place => `
                <div class="list-item">
                    <div>
                        <strong>${place.name}</strong><br>
                        <span style="color: #666; font-size: 14px;">${place.distance} ${place.phone || place.rating || ''}</span>
                    </div>
                    <button class="btn" style="padding: 5px 15px; font-size: 14px;">Navigate</button>
                </div>
            `).join('');
        }

        // Search and Filter Tourists
        document.getElementById('searchTourist')?.addEventListener('input', filterTourists);
        document.getElementById('filterStatus')?.addEventListener('change', filterTourists);

        function filterTourists() {
            const searchTerm = document.getElementById('searchTourist')?.value.toLowerCase() || '';
            const filterStatus = document.getElementById('filterStatus')?.value || 'all';
            const tourists = document.querySelectorAll('#touristsList .list-item');

            tourists.forEach(tourist => {
                const text = tourist.textContent.toLowerCase();
                const matchesSearch = text.includes(searchTerm);
                const matchesFilter = filterStatus === 'all' || text.includes(filterStatus);
                
                tourist.style.display = matchesSearch && matchesFilter ? '' : 'none';
            });
        }
    </script>

    <!-- Safety Tips Modal -->
    <div id="safetyTipsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; max-height: 80vh; overflow-y: auto; margin: 20px;">
            <h2 style="color: #667eea; margin-bottom: 20px;">üìö Safety Tips for Tourists</h2>
            <div id="safetyTipsContent">
                <h3 style="color: #333; margin-top: 15px;">üõ°Ô∏è General Safety:</h3>
                <ul style="line-height: 2; color: #666;">
                    <li>Always keep your location tracking ON in this app</li>
                    <li>Save emergency numbers in your phone contacts</li>
                    <li>Inform family/friends about your itinerary regularly</li>
                    <li>Avoid isolated areas, especially after dark</li>
                    <li>Keep copies of important documents (passport, ID)</li>
                    <li>Stay in well-lit, populated areas</li>
                    <li>Use official taxis and transportation</li>
                </ul>
                
                <h3 style="color: #333; margin-top: 15px;">üìû Emergency Contacts:</h3>
                <ul style="line-height: 2; color: #666;">
                    <li><strong>Police:</strong> 100</li>
                    <li><strong>Ambulance:</strong> 102</li>
                    <li><strong>Fire:</strong> 101</li>
                    <li><strong>Tourist Helpline:</strong> 1363</li>
                    <li><strong>Women Helpline:</strong> 1091</li>
                    <li><strong>Disaster Management:</strong> 108</li>
                </ul>
                
                <h3 style="color: #333; margin-top: 15px;">üè• Health & Safety:</h3>
                <ul style="line-height: 2; color: #666;">
                    <li>Carry a first aid kit and essential medications</li>
                    <li>Stay hydrated, especially in hot weather</li>
                    <li>Be aware of local health advisories and diseases</li>
                    <li>Use sunscreen (SPF 30+) and protective clothing</li>
                    <li>Eat at clean, reputable restaurants</li>
                    <li>Keep travel insurance details handy</li>
                </ul>
                
                <h3 style="color: #333; margin-top: 15px;">üí∞ Money & Valuables:</h3>
                <ul style="line-height: 2; color: #666;">
                    <li>Don't carry large amounts of cash</li>
                    <li>Use hotel safes for valuables</li>
                    <li>Be discreet with expensive jewelry and electronics</li>
                    <li>Keep backup copies of credit cards</li>
                    <li>Beware of pickpockets in crowded areas</li>
                </ul>
                
                <h3 style="color: #333; margin-top: 15px;">üö® In Case of Emergency:</h3>
                <ul style="line-height: 2; color: #666;">
                    <li>Press the SOS button in this app immediately</li>
                    <li>Call local emergency services (100/102)</li>
                    <li>Contact your embassy or consulate</li>
                    <li>Move to a safe, public location</li>
                    <li>Don't panic - help is on the way</li>
                </ul>
            </div>
            <button class="btn" onclick="closeSafetyTips()" style="width: 100%; margin-top: 20px;">Close</button>
        </div>
    </div>
</body>
</html>

